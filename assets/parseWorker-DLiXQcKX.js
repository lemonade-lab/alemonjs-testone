!function(){"use strict";self.onmessage=e=>{const n=e.data;try{const{id:e,input:s,users:t,channels:a}=n,o=function({input:e,users:n,channels:s}){const t=[],a=/<([@#])([^:]+)::([^>]+)>/g;let o,l=0;for(;null!==(o=a.exec(e));){if(l<o.index){const n=e.substring(l,o.index);n&&t.push({type:"Text",value:n})}const u=o[1],r=o[2];if("@"===u){const e=n.find(e=>e.UserId===r);e?t.push({type:"Mention",value:r,options:{belong:"user",payload:{name:e.UserName,avatar:e.UserAvatar}}}):"everyone"===r?t.push({type:"Mention",value:r,options:{belong:"everyone",payload:"everyone"}}):t.push({type:"Text",value:o[0]})}else{const e=s.find(e=>e.ChannelId===r);e?t.push({type:"Mention",value:r,options:{belong:"channel",payload:{name:e.ChannelName,avatar:e.ChannelAvatar}}}):t.push({type:"Text",value:o[0]})}l=a.lastIndex}if(l<e.length){const n=e.substring(l);n&&t.push({type:"Text",value:n})}return t}({input:s,users:t,channels:a});self.postMessage({id:e,ok:!0,data:o})}catch(s){self.postMessage({id:n.id,ok:!1,error:(null==s?void 0:s.message)||"parse error"})}}}();
