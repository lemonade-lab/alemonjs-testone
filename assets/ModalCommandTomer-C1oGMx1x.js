import{r as e,j as s,c as a,d as r,I as t}from"./index.js";import{B as n}from"./BaseModal-pjcrh43B.js";const l=({value:r,name:t,id:n,onChange:l,defaultChecked:i,disabled:d=!1})=>{const[o,c]=e.useState(r);e.useEffect(()=>{c(r)},[r]);const m=()=>{if(d)return;const e=!o;c(e),l&&l(e)};return s.jsxs("div",{className:"relative inline-flex items-center",children:[s.jsx("input",{type:"checkbox",name:t,id:n,checked:o,onChange:m,className:"sr-only",disabled:d,defaultChecked:i}),s.jsx("div",{className:a("w-12 h-6 rounded-full flex items-center cursor-pointer transition-all duration-300 border"),onClick:e=>{e.stopPropagation(),e.preventDefault(),m()},children:s.jsx("div",{className:a("w-4 h-4 bg-white rounded-full shadow transform transition-transform duration-300",{"translate-x-7":o,"translate-x-1":!o})})})]})},i=({open:a,onCancel:i,values:d,onChange:o,commands:c,onConfirm:m})=>{const{time:x,startIndex:u,endIndex:h,loop:p=!1}=d||{},f=!x||Number.isNaN(x)||x<1||x>12,v=e.useMemo(()=>{if(!Array.isArray(c)||0===c.length)return[];const e=Math.max(0,Math.min(u??0,c.length-1)),s="number"==typeof h?Math.max(e,Math.min(h,c.length-1)):c.length-1,a=[];for(let r=0;r<Math.min(5,s-e+1);r++){const s=e+r,t=c[s];a.push({idx:s,name:(null==t?void 0:t.title)||(null==t?void 0:t.text)||`指令#${s+1}`})}return a},[c,u,h]),g=e.useMemo(()=>{if(f)return"—";return r().add(x,"second").format("HH:mm:ss")},[x,f]);return s.jsx(n,{open:a,onCancel:i,titleIcon:s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 flex items-center justify-center text-white text-lg shadow",children:"⏰"}),title:s.jsxs(s.Fragment,{children:["新建循环任务",s.jsx("span",{className:"text-base",children:"🌀"})," "]}),description:"自动按顺序循环发送指令",okText:"🚀 启动任务",onOk:m,width:340,children:s.jsx("form",{className:"flex flex-col animate-fadeIn",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-[var(--editor-foreground)]",children:"速度频率（秒）⚡"}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(t,{type:"number",min:"1",max:"12",step:"0.1",value:x,onChange:e=>{const s=parseFloat(e.target.value);isNaN(s)?o(e=>({...e,time:""})):o(e=>({...e,time:s}))},placeholder:"1 - 12",className:"w-full "+(f&&x?"border-red-500":"border-[var(--input-border)]")})}),f&&x?s.jsx("p",{className:"text-xs text-red-500",children:"请输入 1 - 12 之间的数值"}):s.jsx("p",{className:"text-xs text-[var(--descriptionForeground)] leading-relaxed",children:"所有任务总计不低于 1 秒，低于该频率将被限流"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"text-sm font-medium text-[var(--editor-foreground)] flex items-center justify-between",children:[s.jsx("span",{children:"循环执行 🔁"}),s.jsx(l,{value:!1!==p,onChange:e=>o(s=>({...s,loop:e}))})]}),s.jsx("p",{className:"text-xs text-[var(--descriptionForeground)] leading-relaxed",children:"关闭后仅执行一轮所有指令，自动停止"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-[var(--editor-foreground)]",children:"起始指令 🎯"}),s.jsx("select",{value:u,onChange:e=>{const s=Number(e.target.value);o(e=>{var a,r;return{...e,startIndex:s,commandName:(null==(a=c[s])?void 0:a.title)||(null==(r=c[s])?void 0:r.text)}})},className:"w-full px-3 py-2 rounded-md bg-[var(--input-background)] hover:bg-[var(--activityBar-background)] text-[var(--input-foreground)] border border-[var(--input-border)]",children:Array.isArray(c)&&c.map((e,a)=>s.jsxs("option",{value:a,children:[a+1,". ",e.title||e.text||"未命名"]},a))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-[var(--editor-foreground)]",children:"结束指令 🛑 (含)"}),s.jsx("select",{value:"number"==typeof h?Math.min(h,c.length-1):c.length-1,onChange:e=>{const s=Number(e.target.value);o(e=>({...e,endIndex:s}))},className:"w-full px-3 py-2 rounded-md bg-[var(--input-background)] hover:bg-[var(--activityBar-background)] text-[var(--input-foreground)] border border-[var(--input-border)]",children:Array.isArray(c)&&c.map((e,a)=>s.jsxs("option",{value:a,children:[a+1,". ",e.title||e.text||"未命名"]},a))}),s.jsxs("p",{className:"text-[11px] text-[var(--descriptionForeground)]",children:["不选默认为最后一条指令；区间：#",(u??0)+1," - #",("number"==typeof h?Math.max(u??0,Math.min(h,c.length-1)):c.length-1)+1]})]}),s.jsxs("div",{className:"bg-[var(--editor-inactiveSelection)]/60 backdrop-blur rounded-md p-2 border border-[var(--panel-border)] space-y-2",children:[s.jsx("h4",{className:"text-sm font-medium text-[var(--editor-foreground)] flex items-center gap-2",children:"任务预览 📋"}),s.jsxs("ul",{className:"text-xs space-y-1 text-[var(--editor-foreground)]",children:[s.jsxs("li",{children:[s.jsx("span",{className:"mr-1",children:"🏷️"}),"类型：",s.jsx("span",{className:"font-medium",children:"循环发送任务"})]}),s.jsxs("li",{children:[s.jsx("span",{className:"mr-1",children:"⚡"}),"频率：",s.jsx("span",{className:"font-medium",children:f?"未设置":`${x}s / 次`})]}),s.jsxs("li",{children:[s.jsx("span",{className:"mr-1",children:"🧮"}),"区间指令数：",s.jsxs("span",{className:"font-medium",children:[(()=>{if(!c.length)return 0;const e=Math.max(0,Math.min(u??0,c.length-1));return("number"==typeof h?Math.max(e,Math.min(h,c.length-1)):c.length-1)-e+1})(),"/",c.length]})]}),s.jsxs("li",{children:[s.jsx("span",{className:"mr-1",children:"🔁"}),"模式：",s.jsx("span",{className:"font-medium",children:!1===p?"单轮执行":"循环执行"})]}),s.jsxs("li",{children:[s.jsx("span",{className:"mr-1",children:"⏱️"}),"预计首轮下一次执行时间：",s.jsx("span",{className:"font-medium",children:g})]})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("div",{className:"text-[11px] font-medium mb-1 text-[var(--descriptionForeground)] flex items-center gap-1",children:"📌 即将执行的指令顺序（预览）"}),v.length>0?s.jsx("div",{className:"flex flex-col gap-1",children:v.map((e,a)=>s.jsxs("div",{className:"text-[11px] px-2 py-1 rounded border border-transparent "+(0===a?"bg-blue-500/15 border-blue-500/40 text-blue-400":"bg-[var(--editor-inactiveSelection)]"),children:[0===a?"➡️ 当前起点":`→ 第 ${a+1} 步`," ：#",e.idx+1," ",e.name]},e.idx))}):s.jsx("div",{className:"text-[11px] opacity-70",children:"无可预览内容"})]})]})]})})})};export{i as default};
